<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a3d2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SukhSafar Driver</title>

    <!--
        ‚ö° PERFORMANCE NOTE:
        - No external JS libraries (no React, no jQuery)
        - No heavy map SDK on load ‚Äî maps load only when needed
        - CSS-only animations ‚Äî no JS animation libraries
        - Minimal DOM ‚Äî only active screen rendered
        - localStorage for offline data persistence
        - Target: < 150KB total page weight
    -->

    <style>
        :root {
            --forest:  #0a3d2e;
            --forest2: #0f5c42;
            --gold:    #f0c040;
            --cream:   #fdf8ef;
            --green:   #22c55e;
            --red:     #ef4444;
            --bg:      #f0f4f2;
            --white:   #ffffff;
            --text:    #1a2e26;
            --muted:   #6b7c75;
            --border:  #dce8e0;
            --r:       12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        html, body { height:100%; overflow:hidden; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background:var(--bg); }

        /* ===== SCREENS ===== */
        .screen { display:none; height:100dvh; flex-direction:column; overflow:hidden; }
        .screen.active { display:flex; }

        /* ===== LOGIN SCREEN ===== */
        #screen-login {
            background: linear-gradient(160deg, #071e17, var(--forest));
            align-items:center; justify-content:center; padding:30px 24px;
            text-align:center;
        }
        .login-logo {
            font-size:3em; margin-bottom:8px;
        }
        .login-brand {
            font-size:2em; font-weight:800; color:var(--gold);
            letter-spacing:-0.5px; margin-bottom:4px;
        }
        .login-sub { color:rgba(255,255,255,0.5); font-size:13px; margin-bottom:36px; }
        .login-card {
            background:white; border-radius:var(--r); padding:24px; width:100%;
        }
        .login-card h3 { color:var(--forest); font-size:1.1em; margin-bottom:20px; font-weight:700; }
        .field { margin-bottom:16px; }
        .field label { display:block; font-size:12px; font-weight:600; color:var(--muted); margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px; }
        .field input {
            width:100%; padding:14px 16px; border:2px solid var(--border);
            border-radius:10px; font-size:15px; font-family:inherit;
            color:var(--text); background:var(--cream); outline:none;
            transition:border 0.2s;
        }
        .field input:focus { border-color:var(--forest2); }
        .login-btn {
            width:100%; padding:15px; background:linear-gradient(135deg,var(--forest),var(--forest2));
            color:white; border:none; border-radius:10px; font-size:16px;
            font-weight:700; cursor:pointer; font-family:inherit; margin-top:8px;
            transition:opacity 0.2s;
        }
        .login-btn:active { opacity:0.85; }

        /* ===== TOP BAR ===== */
        .topbar {
            background:var(--forest); color:white;
            padding:14px 16px calc(14px + env(safe-area-inset-top));
            padding-top:calc(14px + env(safe-area-inset-top));
            display:flex; align-items:center; justify-content:space-between;
            flex-shrink:0;
        }
        .topbar-logo { font-size:1.1em; font-weight:800; color:var(--gold); }
        .topbar-right { display:flex; align-items:center; gap:10px; }
        .online-toggle {
            display:flex; align-items:center; gap:8px;
            background:rgba(255,255,255,0.1); border:none; border-radius:20px;
            padding:8px 14px; color:white; font-size:13px; font-weight:600;
            cursor:pointer; font-family:inherit; transition:all 0.2s;
        }
        .online-toggle .dot {
            width:8px; height:8px; border-radius:50%;
            background:var(--red); transition:background 0.3s;
        }
        .online-toggle.online .dot { background:var(--green); }
        .online-toggle.online { background:rgba(34,197,94,0.15); }

        /* ===== SCROLLABLE BODY ===== */
        .screen-body {
            flex:1; overflow-y:auto; padding:16px;
            -webkit-overflow-scrolling:touch;
        }

        /* ===== CARDS ===== */
        .card {
            background:white; border-radius:var(--r);
            border:1px solid var(--border); margin-bottom:14px;
            overflow:hidden;
        }
        .card-head {
            padding:14px 16px; border-bottom:1px solid var(--border);
            font-weight:700; font-size:14px; color:var(--muted);
            text-transform:uppercase; letter-spacing:0.5px;
            display:flex; align-items:center; justify-content:space-between;
        }
        .card-body { padding:16px; }

        /* ===== EARNINGS SUMMARY ===== */
        .earn-grid {
            display:grid; grid-template-columns:repeat(3,1fr); gap:10px;
        }
        .earn-box {
            background:var(--bg); border-radius:10px; padding:14px 10px;
            text-align:center;
        }
        .earn-num { font-size:1.4em; font-weight:800; color:var(--forest); }
        .earn-label { font-size:11px; color:var(--muted); margin-top:3px; }
        .earn-box.highlight .earn-num { color:var(--gold); }
        .earn-box.highlight { background:var(--forest); }
        .earn-box.highlight .earn-label { color:rgba(255,255,255,0.5); }

        /* ===== ACTIVE RIDE CARD ===== */
        .ride-card {
            background:linear-gradient(135deg,var(--forest),var(--forest2));
            color:white; border-radius:var(--r); padding:20px;
            margin-bottom:14px; display:none;
        }
        .ride-card.active { display:block; }
        .ride-badge {
            display:inline-block; background:var(--gold); color:var(--forest);
            font-size:11px; font-weight:800; padding:4px 10px; border-radius:20px;
            margin-bottom:12px; text-transform:uppercase; letter-spacing:0.5px;
        }
        .ride-route { margin-bottom:16px; }
        .route-point { display:flex; align-items:center; gap:10px; padding:6px 0; }
        .route-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
        .route-dot.green { background:var(--green); }
        .route-dot.gold { background:var(--gold); }
        .route-line { width:2px; height:20px; background:rgba(255,255,255,0.2); margin-left:4px; }
        .route-text { font-size:14px; color:rgba(255,255,255,0.9); }
        .ride-meta { display:flex; gap:10px; }
        .ride-meta-box {
            flex:1; background:rgba(255,255,255,0.1); border-radius:8px;
            padding:10px; text-align:center;
        }
        .ride-meta-val { font-size:1.1em; font-weight:800; color:var(--gold); }
        .ride-meta-label { font-size:11px; color:rgba(255,255,255,0.5); margin-top:2px; }
        .ride-actions { display:flex; gap:10px; margin-top:14px; }
        .btn-sm {
            flex:1; padding:12px; border:none; border-radius:8px;
            font-size:14px; font-weight:700; cursor:pointer; font-family:inherit;
            transition:opacity 0.2s;
        }
        .btn-sm:active { opacity:0.8; }
        .btn-navigate { background:white; color:var(--forest); }
        .btn-complete { background:var(--gold); color:var(--forest); }

        /* ===== INCOMING RIDE ===== */
        .incoming-overlay {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,0.7); z-index:200;
            align-items:flex-end;
        }
        .incoming-overlay.show { display:flex; }
        .incoming-modal {
            background:white; border-radius:20px 20px 0 0;
            padding:24px; width:100%;
            animation:slideUp 0.3s cubic-bezier(0.25,0.46,0.45,0.94);
        }
        @keyframes slideUp {
            from { transform:translateY(100%); }
            to   { transform:translateY(0); }
        }
        .incoming-header { text-align:center; margin-bottom:20px; }
        .incoming-pulse {
            width:56px; height:56px; border-radius:50%;
            background:var(--forest); margin:0 auto 10px;
            display:flex; align-items:center; justify-content:center;
            font-size:1.6em; animation:pulse 1s infinite;
        }
        @keyframes pulse {
            0%,100% { box-shadow:0 0 0 0 rgba(10,61,46,0.4); }
            50% { box-shadow:0 0 0 16px rgba(10,61,46,0); }
        }
        .incoming-title { font-size:1.1em; font-weight:800; color:var(--forest); }
        .incoming-timer { font-size:2.5em; font-weight:900; color:var(--red); text-align:center; margin:8px 0; }
        .incoming-route { background:var(--bg); border-radius:10px; padding:14px; margin-bottom:16px; }
        .incoming-route .row { display:flex; align-items:center; gap:10px; padding:4px 0; font-size:14px; }
        .incoming-route .row span:last-child { color:var(--muted); }
        .incoming-btns { display:flex; gap:12px; }
        .btn-accept {
            flex:1; padding:14px; background:var(--forest); color:white;
            border:none; border-radius:10px; font-size:15px; font-weight:700;
            cursor:pointer; font-family:inherit;
        }
        .btn-reject {
            padding:14px 20px; background:var(--bg); color:var(--muted);
            border:1px solid var(--border); border-radius:10px; font-size:14px;
            font-weight:600; cursor:pointer; font-family:inherit;
        }

        /* ===== HISTORY LIST ===== */
        .history-item {
            display:flex; justify-content:space-between; align-items:center;
            padding:14px 0; border-bottom:1px solid var(--border);
        }
        .history-item:last-child { border:none; }
        .hist-route { font-size:14px; font-weight:600; color:var(--text); }
        .hist-time { font-size:12px; color:var(--muted); margin-top:3px; }
        .hist-fare { font-size:1.1em; font-weight:800; color:var(--forest); }
        .hist-status {
            font-size:11px; font-weight:600; padding:3px 8px;
            border-radius:20px; margin-top:3px; text-align:right;
        }
        .hist-status.done { background:#dcfce7; color:#166534; }
        .hist-status.cancelled { background:#fee2e2; color:#991b1b; }

        /* ===== PROFILE SCREEN ===== */
        .profile-avatar {
            width:80px; height:80px; border-radius:50%;
            background:linear-gradient(135deg,var(--forest),var(--forest2));
            margin:0 auto 12px; display:flex; align-items:center;
            justify-content:center; font-size:2.2em; color:white; font-weight:800;
        }
        .profile-name { text-align:center; font-size:1.3em; font-weight:800; color:var(--text); }
        .profile-id { text-align:center; font-size:13px; color:var(--muted); margin-bottom:24px; }
        .profile-row {
            display:flex; align-items:center; justify-content:space-between;
            padding:16px 0; border-bottom:1px solid var(--border);
        }
        .profile-row:last-child { border:none; }
        .profile-row .label { font-size:14px; font-weight:600; color:var(--text); display:flex; align-items:center; gap:10px; }
        .profile-row .val { font-size:14px; color:var(--muted); }
        .logout-btn {
            width:100%; padding:14px; background:#fee2e2; color:var(--red);
            border:none; border-radius:10px; font-size:15px; font-weight:700;
            cursor:pointer; font-family:inherit; margin-top:16px;
        }

        /* ===== BOTTOM NAV ===== */
        .bottom-nav {
            display:flex; background:white;
            border-top:1px solid var(--border);
            padding:8px 0 calc(8px + env(safe-area-inset-bottom));
            flex-shrink:0;
        }
        .nav-btn {
            flex:1; display:flex; flex-direction:column;
            align-items:center; gap:3px; padding:6px;
            border:none; background:none; cursor:pointer;
            color:var(--muted); font-family:inherit; transition:all 0.2s;
        }
        .nav-btn .ic { font-size:1.35em; }
        .nav-btn .lbl { font-size:10px; font-weight:500; }
        .nav-btn.active { color:var(--forest); }
        .nav-btn.active .lbl { font-weight:700; }

        /* ===== LOADING ===== */
        .loading { text-align:center; padding:40px 20px; color:var(--muted); font-size:14px; }

        /* ===== UTILS ===== */
        .green-text { color:#22c55e; }
        .red-text { color:var(--red); }
        .gold-text { color:#d97706; }
    </style>
</head>
<body>

<!-- ===== LOGIN SCREEN ===== -->
<div class="screen active" id="screen-login">
    <div class="login-logo">‚ö°</div>
    <div class="login-brand">SukhSafar</div>
    <p class="login-sub">Driver Partner App</p>
    <div class="login-card">
        <h3>üîê Driver Login</h3>
        <div class="field">
            <label>Mobile Number</label>
            <input type="tel" id="login-phone" placeholder="98XXXXXXXX" maxlength="10" inputmode="numeric">
        </div>
        <div class="field">
            <label>PIN (4 digits)</label>
            <input type="password" id="login-pin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric">
        </div>
        <button class="login-btn" onclick="doLogin()">Login Karein ‚Üí</button>
        <p style="text-align:center;font-size:12px;color:#aaa;margin-top:14px;">
            New driver? WhatsApp: +91 88601 60942
        </p>
    </div>
</div>

<!-- ===== HOME SCREEN ===== -->
<div class="screen" id="screen-home">
    <div class="topbar">
        <div class="topbar-logo">‚ö° SukhSafar</div>
        <div class="topbar-right">
            <button class="online-toggle" id="online-toggle" onclick="toggleOnline()">
                <span class="dot"></span>
                <span id="online-label">Offline</span>
            </button>
        </div>
    </div>

    <div class="screen-body">
        <!-- Active Ride (hidden by default) -->
        <div class="ride-card" id="active-ride">
            <div class="ride-badge">üü¢ Active Ride</div>
            <div class="ride-route">
                <div class="route-point">
                    <div class="route-dot green"></div>
                    <div class="route-text" id="ar-pickup">Sector 29, Gurugram</div>
                </div>
                <div class="route-line"></div>
                <div class="route-point">
                    <div class="route-dot gold"></div>
                    <div class="route-text" id="ar-drop">Huda City Centre</div>
                </div>
            </div>
            <div class="ride-meta">
                <div class="ride-meta-box">
                    <div class="ride-meta-val" id="ar-km">8 km</div>
                    <div class="ride-meta-label">Distance</div>
                </div>
                <div class="ride-meta-box">
                    <div class="ride-meta-val" id="ar-fare">‚Çπ126</div>
                    <div class="ride-meta-label">Fare</div>
                </div>
                <div class="ride-meta-box">
                    <div class="ride-meta-val" id="ar-earn">‚Çπ101</div>
                    <div class="ride-meta-label">Your 80%</div>
                </div>
            </div>
            <div class="ride-actions">
                <button class="btn-sm btn-navigate" onclick="navigate()">üó∫Ô∏è Navigate</button>
                <button class="btn-sm btn-complete" onclick="completeRide()">‚úÖ Complete</button>
            </div>
        </div>

        <!-- Today's Earnings -->
        <div class="card">
            <div class="card-head">
                <span>üìä Aaj Ki Kamai</span>
                <span id="today-date" style="font-size:12px;font-weight:400;"></span>
            </div>
            <div class="card-body">
                <div class="earn-grid">
                    <div class="earn-box">
                        <div class="earn-num" id="today-rides">0</div>
                        <div class="earn-label">Rides</div>
                    </div>
                    <div class="earn-box">
                        <div class="earn-num" id="today-km">0</div>
                        <div class="earn-label">KM</div>
                    </div>
                    <div class="earn-box highlight">
                        <div class="earn-num" id="today-earn">‚Çπ0</div>
                        <div class="earn-label">Kamaai</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Battery & Status -->
        <div class="card">
            <div class="card-head">üîã Car Status</div>
            <div class="card-body">
                <div style="display:flex;gap:12px;">
                    <div style="flex:1;background:var(--bg);border-radius:10px;padding:14px;text-align:center;">
                        <div style="font-size:1.6em;font-weight:800;color:var(--forest);" id="car-battery">78%</div>
                        <div style="font-size:11px;color:var(--muted);margin-top:3px;">Battery</div>
                        <div style="background:#e2e8f0;height:6px;border-radius:3px;margin-top:8px;overflow:hidden;">
                            <div id="battery-bar" style="background:#22c55e;height:100%;border-radius:3px;width:78%;transition:width 0.5s;"></div>
                        </div>
                    </div>
                    <div style="flex:1;background:var(--bg);border-radius:10px;padding:14px;text-align:center;">
                        <div style="font-size:1.6em;font-weight:800;color:var(--forest);" id="car-range">156 km</div>
                        <div style="font-size:11px;color:var(--muted);margin-top:3px;">Remaining Range</div>
                    </div>
                </div>
                <p style="font-size:12px;color:var(--muted);margin-top:12px;text-align:center;">
                    üí° Ghar pe charge karein ‚Äî ‚Çπ6-10/kWh only
                </p>
            </div>
        </div>

        <!-- Weekly Summary -->
        <div class="card">
            <div class="card-head">üìÖ Is Hafte</div>
            <div class="card-body">
                <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
                    <span style="font-size:13px;color:var(--muted);">Kul Kamai</span>
                    <span style="font-weight:800;color:var(--forest);font-size:1.1em;" id="week-earn">‚Çπ0</span>
                </div>
                <div style="display:flex;justify-content:space-between;margin-bottom:12px;">
                    <span style="font-size:13px;color:var(--muted);">Total Rides</span>
                    <span style="font-weight:700;" id="week-rides">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;">
                    <span style="font-size:13px;color:var(--muted);">Daily Average</span>
                    <span style="font-weight:700;color:#22c55e;" id="week-avg">‚Çπ0/day</span>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" onclick="showTab('home',this)"><span class="ic">üè†</span><span class="lbl">Home</span></button>
        <button class="nav-btn" onclick="showTab('history',this)"><span class="ic">üìã</span><span class="lbl">History</span></button>
        <button class="nav-btn" onclick="showTab('earn',this)"><span class="ic">üí∞</span><span class="lbl">Kamai</span></button>
        <button class="nav-btn" onclick="showTab('profile',this)"><span class="ic">üë§</span><span class="lbl">Profile</span></button>
    </div>
</div>

<!-- ===== HISTORY SCREEN ===== -->
<div class="screen" id="screen-history">
    <div class="topbar">
        <div class="topbar-logo">üìã Ride History</div>
    </div>
    <div class="screen-body">
        <div class="card">
            <div class="card-head">Pichli Rides</div>
            <div class="card-body" id="history-list">
                <div class="loading">Koi rides nahi abhi tak</div>
            </div>
        </div>
    </div>
    <div class="bottom-nav">
        <button class="nav-btn" onclick="showTab('home',this)"><span class="ic">üè†</span><span class="lbl">Home</span></button>
        <button class="nav-btn active" onclick="showTab('history',this)"><span class="ic">üìã</span><span class="lbl">History</span></button>
        <button class="nav-btn" onclick="showTab('earn',this)"><span class="ic">üí∞</span><span class="lbl">Kamai</span></button>
        <button class="nav-btn" onclick="showTab('profile',this)"><span class="ic">üë§</span><span class="lbl">Profile</span></button>
    </div>
</div>

<!-- ===== EARNINGS SCREEN ===== -->
<div class="screen" id="screen-earn">
    <div class="topbar">
        <div class="topbar-logo">üí∞ Kamai</div>
    </div>
    <div class="screen-body">
        <div class="card">
            <div class="card-head">Is Mahine Ki Kamai</div>
            <div class="card-body">
                <div class="earn-grid">
                    <div class="earn-box">
                        <div class="earn-num" id="m-rides">0</div>
                        <div class="earn-label">Rides</div>
                    </div>
                    <div class="earn-box">
                        <div class="earn-num" id="m-km">0</div>
                        <div class="earn-label">KM</div>
                    </div>
                    <div class="earn-box highlight">
                        <div class="earn-num" id="m-earn">‚Çπ0</div>
                        <div class="earn-label">Net Kamai</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">Breakdown</div>
            <div class="card-body" id="earn-breakdown">
                <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);">
                    <span style="font-size:14px;color:var(--muted);">Gross Ride Revenue</span>
                    <span style="font-weight:700;" id="b-gross">‚Çπ0</span>
                </div>
                <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);">
                    <span style="font-size:14px;color:var(--muted);">Platform share (20%)</span>
                    <span style="font-weight:700;color:var(--red);" id="b-platform">‚àí‚Çπ0</span>
                </div>
                <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);">
                    <span style="font-size:14px;color:var(--muted);">Daily Car Rent</span>
                    <span style="font-weight:700;color:var(--red);" id="b-rent">‚àí‚Çπ0</span>
                </div>
                <div style="display:flex;justify-content:space-between;padding:10px 0;">
                    <span style="font-size:15px;font-weight:800;color:var(--forest);">Net Kamai üéâ</span>
                    <span style="font-size:1.1em;font-weight:800;color:#22c55e;" id="b-net">‚Çπ0</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">üí° Earning Tips</div>
            <div class="card-body">
                <div style="font-size:13px;line-height:1.8;color:var(--muted);">
                    ‚è∞ <strong>Peak hours:</strong> 8-10am, 5-8pm ‚Äî zyada demand<br>
                    üè¢ <strong>Corporate zones:</strong> Cyber City, DLF Phases ‚Äî long rides<br>
                    üåô <strong>Night rides:</strong> ‚Çπ14/km ‚Äî zyada kamaai<br>
                    üîã <strong>Ghar pe charge:</strong> ‚Çπ180 save per day vs fast charger<br>
                    ‚≠ê <strong>5-star rating:</strong> Zyada ride requests milte hain
                </div>
            </div>
        </div>
    </div>
    <div class="bottom-nav">
        <button class="nav-btn" onclick="showTab('home',this)"><span class="ic">üè†</span><span class="lbl">Home</span></button>
        <button class="nav-btn" onclick="showTab('history',this)"><span class="ic">üìã</span><span class="lbl">History</span></button>
        <button class="nav-btn active" onclick="showTab('earn',this)"><span class="ic">üí∞</span><span class="lbl">Kamai</span></button>
        <button class="nav-btn" onclick="showTab('profile',this)"><span class="ic">üë§</span><span class="lbl">Profile</span></button>
    </div>
</div>

<!-- ===== PROFILE SCREEN ===== -->
<div class="screen" id="screen-profile">
    <div class="topbar">
        <div class="topbar-logo">üë§ Profile</div>
    </div>
    <div class="screen-body">
        <div class="card">
            <div class="card-body">
                <div class="profile-avatar" id="prof-avatar">R</div>
                <div class="profile-name" id="prof-name">Rahul Kumar</div>
                <div class="profile-id" id="prof-id">Driver ID: SS-GGN-001</div>
                <div class="profile-row">
                    <span class="label">üì± Mobile</span>
                    <span class="val" id="prof-phone">98XXXXXXXX</span>
                </div>
                <div class="profile-row">
                    <span class="label">üöó Car</span>
                    <span class="val">Tata Tigor EV</span>
                </div>
                <div class="profile-row">
                    <span class="label">üî¢ Reg. No.</span>
                    <span class="val">HR 26 XX XXXX</span>
                </div>
                <div class="profile-row">
                    <span class="label">‚≠ê Rating</span>
                    <span class="val gold-text">4.8 / 5.0</span>
                </div>
                <div class="profile-row">
                    <span class="label">üìÖ Member since</span>
                    <span class="val">Jan 2025</span>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ Logout</button>
            </div>
        </div>

        <div class="card">
            <div class="card-head">üìû Support</div>
            <div class="card-body">
                <a href="tel:+919999999999" style="display:flex;align-items:center;gap:12px;padding:10px 0;text-decoration:none;color:var(--text);">
                    <span style="font-size:1.4em;">üìû</span>
                    <div><div style="font-weight:600;font-size:14px;">Emergency Support</div><div style="font-size:12px;color:var(--muted);">+91 88601 60942 ¬∑ 24/7</div></div>
                </a>
                <a href="https://wa.me/918860160942" style="display:flex;align-items:center;gap:12px;padding:10px 0;text-decoration:none;color:var(--text);">
                    <span style="font-size:1.4em;">üí¨</span>
                    <div><div style="font-weight:600;font-size:14px;">WhatsApp Support</div><div style="font-size:12px;color:var(--muted);">Kisi bhi problem ke liye</div></div>
                </a>
            </div>
        </div>
    </div>
    <div class="bottom-nav">
        <button class="nav-btn" onclick="showTab('home',this)"><span class="ic">üè†</span><span class="lbl">Home</span></button>
        <button class="nav-btn" onclick="showTab('history',this)"><span class="ic">üìã</span><span class="lbl">History</span></button>
        <button class="nav-btn" onclick="showTab('earn',this)"><span class="ic">üí∞</span><span class="lbl">Kamai</span></button>
        <button class="nav-btn active" onclick="showTab('profile',this)"><span class="ic">üë§</span><span class="lbl">Profile</span></button>
    </div>
</div>

<!-- ===== INCOMING RIDE MODAL ===== -->
<div class="incoming-overlay" id="incoming-overlay">
    <div class="incoming-modal">
        <div class="incoming-header">
            <div class="incoming-pulse">üîî</div>
            <div class="incoming-title">Nayi Ride Request!</div>
        </div>
        <div class="incoming-timer" id="incoming-timer">15</div>
        <div class="incoming-route">
            <div class="row">üü¢ <span id="inc-pickup">Sector 47, Gurugram</span></div>
            <div style="height:8px"></div>
            <div class="row">üü° <span id="inc-drop">MG Road Metro Station</span></div>
            <div style="height:10px"></div>
            <div style="display:flex;gap:10px;margin-top:6px;">
                <span style="background:white;padding:6px 12px;border-radius:20px;font-size:13px;font-weight:700;" id="inc-km">6 km</span>
                <span style="background:white;padding:6px 12px;border-radius:20px;font-size:13px;font-weight:700;color:var(--forest);" id="inc-fare">‚Çπ102</span>
                <span style="background:#dcfce7;padding:6px 12px;border-radius:20px;font-size:13px;font-weight:700;color:#166534;" id="inc-earn">+‚Çπ82</span>
            </div>
        </div>
        <div class="incoming-btns">
            <button class="btn-accept" onclick="acceptRide()">‚úÖ Accept</button>
            <button class="btn-reject" onclick="rejectRide()">‚úï</button>
        </div>
    </div>
</div>

<script>
// ===== STATE =====
let state = {
    loggedIn: false,
    online: false,
    driverName: 'Rahul Kumar',
    driverPhone: '',
    todayRides: 0,
    todayKm: 0,
    todayEarn: 0,
    weekRides: 0,
    weekKm: 0,
    weekEarn: 0,
    monthRides: 0,
    monthKm: 0,
    monthEarn: 0,
    history: [],
    activeRide: null,
    battery: 78,
};

// Load from localStorage
try {
    const saved = localStorage.getItem('ss_driver_state');
    if (saved) { const parsed = JSON.parse(saved); Object.assign(state, parsed); }
} catch(e) {}

function save() {
    try { localStorage.setItem('ss_driver_state', JSON.stringify(state)); } catch(e) {}
}

// ===== LOGIN =====
function doLogin() {
    const phone = document.getElementById('login-phone').value.trim();
    const pin   = document.getElementById('login-pin').value.trim();
    if (phone.length < 10) { alert('Sahi mobile number daalo'); return; }
    if (pin.length < 4)    { alert('4 digit PIN daalo'); return; }
    // Demo: accept any valid format
    state.loggedIn = true;
    state.driverPhone = phone;
    save();
    showScreen('home');
    initHome();
}

// ===== SCREEN ROUTING =====
function showScreen(name) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('screen-' + name).classList.add('active');
}

function showTab(tab, btn) {
    const map = { home:'home', history:'history', earn:'earn', profile:'profile' };
    showScreen(map[tab]);
    // Refresh data on each tab
    if (tab === 'history') renderHistory();
    if (tab === 'earn')    renderEarnings();
    if (tab === 'profile') renderProfile();
}

// ===== ONLINE TOGGLE =====
function toggleOnline() {
    state.online = !state.online;
    const toggle = document.getElementById('online-toggle');
    const label  = document.getElementById('online-label');
    toggle.classList.toggle('online', state.online);
    label.textContent = state.online ? 'Online' : 'Offline';
    if (state.online) {
        // Simulate incoming ride after 3‚Äì8 seconds
        setTimeout(showIncomingRide, 3000 + Math.random() * 5000);
    }
}

// ===== INCOMING RIDE SIMULATION =====
const sampleRoutes = [
    { pickup: 'Sector 29, Gurugram', drop: 'Huda City Centre Metro', km: 7 },
    { pickup: 'DLF Cyber City', drop: 'Sikanderpur Metro', km: 5 },
    { pickup: 'South City 1', drop: 'IFFCO Chowk', km: 9 },
    { pickup: 'Palam Vihar', drop: 'Gurugram Railway Station', km: 12 },
    { pickup: 'Sector 56', drop: 'MG Road', km: 8 },
];
let incomingTimer, timerCount;

function showIncomingRide() {
    if (!state.online || state.activeRide) return;
    const route = sampleRoutes[Math.floor(Math.random() * sampleRoutes.length)];
    const fare  = 30 + route.km * 12;
    const earn  = Math.round(fare * 0.8);
    document.getElementById('inc-pickup').textContent = route.pickup;
    document.getElementById('inc-drop').textContent   = route.drop;
    document.getElementById('inc-km').textContent     = route.km + ' km';
    document.getElementById('inc-fare').textContent   = '‚Çπ' + fare;
    document.getElementById('inc-earn').textContent   = '+‚Çπ' + earn;
    document.getElementById('incoming-overlay').classList.add('show');
    timerCount = 15;
    document.getElementById('incoming-timer').textContent = timerCount;
    incomingTimer = setInterval(() => {
        timerCount--;
        document.getElementById('incoming-timer').textContent = timerCount;
        if (timerCount <= 0) { clearInterval(incomingTimer); rejectRide(); }
    }, 1000);
    // Store for accept
    window._pendingRide = { ...route, fare, earn };
}

function acceptRide() {
    clearInterval(incomingTimer);
    document.getElementById('incoming-overlay').classList.remove('show');
    const r = window._pendingRide;
    state.activeRide = r;
    document.getElementById('ar-pickup').textContent = r.pickup;
    document.getElementById('ar-drop').textContent   = r.drop;
    document.getElementById('ar-km').textContent     = r.km + ' km';
    document.getElementById('ar-fare').textContent   = '‚Çπ' + r.fare;
    document.getElementById('ar-earn').textContent   = '‚Çπ' + r.earn;
    document.getElementById('active-ride').classList.add('active');
    showScreen('home');
}

function rejectRide() {
    clearInterval(incomingTimer);
    document.getElementById('incoming-overlay').classList.remove('show');
    if (state.online) {
        setTimeout(showIncomingRide, 5000 + Math.random() * 10000);
    }
}

function completeRide() {
    if (!state.activeRide) return;
    const r = state.activeRide;
    state.todayRides++;
    state.todayKm    += r.km;
    state.todayEarn  += r.earn;
    state.weekRides++;
    state.weekKm     += r.km;
    state.weekEarn   += r.earn;
    state.monthRides++;
    state.monthKm    += r.km;
    state.monthEarn  += r.earn;
    state.battery    = Math.max(10, state.battery - Math.round(r.km * 0.45));
    state.history.unshift({
        pickup: r.pickup, drop: r.drop, km: r.km,
        fare: r.fare, earn: r.earn, status: 'done',
        time: new Date().toLocaleTimeString('hi-IN', { hour:'2-digit', minute:'2-digit' })
    });
    state.activeRide = null;
    save();
    document.getElementById('active-ride').classList.remove('active');
    updateHomeStats();
    if (state.online) {
        setTimeout(showIncomingRide, 4000 + Math.random() * 8000);
    }
}

function navigate() {
    if (!state.activeRide) return;
    const q = encodeURIComponent(state.activeRide.drop);
    window.open('https://maps.google.com/?q=' + q, '_blank');
}

// ===== RENDER =====
function initHome() {
    const now = new Date();
    document.getElementById('today-date').textContent =
        now.toLocaleDateString('hi-IN', { day:'numeric', month:'short' });
    updateHomeStats();
    updateBattery();
}

function updateHomeStats() {
    document.getElementById('today-rides').textContent = state.todayRides;
    document.getElementById('today-km').textContent    = state.todayKm;
    document.getElementById('today-earn').textContent  = '‚Çπ' + state.todayEarn;
    const days = state.weekRides > 0 ? Math.min(7, state.weekRides) : 1;
    document.getElementById('week-earn').textContent = '‚Çπ' + state.weekEarn;
    document.getElementById('week-rides').textContent = state.weekRides;
    document.getElementById('week-avg').textContent = '‚Çπ' + Math.round(state.weekEarn / days) + '/day';
}

function updateBattery() {
    const b = state.battery;
    document.getElementById('car-battery').textContent = b + '%';
    document.getElementById('car-range').textContent   = Math.round(b * 2) + ' km';
    const bar = document.getElementById('battery-bar');
    bar.style.width = b + '%';
    bar.style.background = b > 50 ? '#22c55e' : b > 25 ? '#f59e0b' : '#ef4444';
}

function renderHistory() {
    const el = document.getElementById('history-list');
    if (!state.history.length) {
        el.innerHTML = '<div class="loading">Koi rides nahi abhi tak</div>';
        return;
    }
    el.innerHTML = state.history.slice(0, 30).map(r => `
        <div class="history-item">
            <div>
                <div class="hist-route">${r.pickup} ‚Üí ${r.drop}</div>
                <div class="hist-time">${r.time} ¬∑ ${r.km} km</div>
            </div>
            <div style="text-align:right;">
                <div class="hist-fare">‚Çπ${r.earn}</div>
                <div class="hist-status done">Completed</div>
            </div>
        </div>
    `).join('');
}

function renderEarnings() {
    document.getElementById('m-rides').textContent = state.monthRides;
    document.getElementById('m-km').textContent    = state.monthKm;
    document.getElementById('m-earn').textContent  = '‚Çπ' + state.monthEarn;
    const gross    = Math.round(state.monthEarn / 0.8);
    const platform = gross - state.monthEarn;
    const rent     = state.monthRides * 250;
    const net      = state.monthEarn - rent;
    document.getElementById('b-gross').textContent    = '‚Çπ' + gross;
    document.getElementById('b-platform').textContent = '‚àí‚Çπ' + platform;
    document.getElementById('b-rent').textContent     = '‚àí‚Çπ' + rent;
    document.getElementById('b-net').textContent      = '‚Çπ' + Math.max(0, net);
}

function renderProfile() {
    document.getElementById('prof-phone').textContent = state.driverPhone || '98XXXXXXXX';
    document.getElementById('prof-avatar').textContent = state.driverName.charAt(0).toUpperCase();
    document.getElementById('prof-name').textContent   = state.driverName;
}

function logout() {
    if (confirm('Logout karna chahte hain?')) {
        state.loggedIn = false; save();
        showScreen('login');
    }
}

// ===== INIT =====
if (state.loggedIn) {
    showScreen('home');
    initHome();
    updateBattery();
} else {
    showScreen('login');
}

// Add demo data for testing
window.addDemoData = function() {
    state.todayRides = 8; state.todayKm = 62; state.todayEarn = 1340;
    state.weekRides  = 35; state.weekKm = 280; state.weekEarn = 5900;
    state.monthRides = 112; state.monthKm = 890; state.monthEarn = 18700;
    state.history = [
        { pickup:'Cyber City', drop:'Sikanderpur Metro', km:4, fare:78, earn:62, status:'done', time:'09:14' },
        { pickup:'Sector 47', drop:'MG Road', km:8, fare:126, earn:101, status:'done', time:'10:32' },
        { pickup:'South City', drop:'HUDA City Centre', km:11, fare:162, earn:130, status:'done', time:'12:05' },
    ];
    save(); updateHomeStats(); updateBattery();
    alert('Demo data loaded! History aur Kamai tabs dekhein.');
};
</script>
</body>
</html>
